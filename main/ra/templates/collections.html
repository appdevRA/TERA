{% load static %}

{% block headerinclude %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERA</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/navbarstyle.css' %}">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/modal.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/abb9521de4.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" >
    <style>
table {
  border-spacing: 2;
  width: 100%;
  border: 1px solid #ddd;
}

th, td {
  text-align: left;
  padding: 16px;
}

tr:nth-child(even) {
  background-color: #f2f2f2
}
</style>
</head>
{% endblock headerinclude %}


<body style="background-color: #f3f3f3">
    <nav>
      <div class="logo"><a href="{% url 'ra:index_view'%}"><img class="logo-style" src="{% static 'images/teralogo.png' %}"></a></div>
      <label for="btn" class="icon">
        <span class=></span>
      </label>
     
      <ul>     
      
      

       <li>
                <label for="btn-2" class="show">My Account <i class="fa fa-user" aria-hidden="true"></i></label>
                <a href="#">My Account <i class="fa fa-user" aria-hidden="true"></i></a>
                
                <ul>
                <li><a href="{% url 'ra:tera_dashboard_view'%}">Search</a></li>  
                <li><a href="{% url 'ra:tera_account_settings'%}">Change pass</a></li>
                <li>

                  <form  action = "" method = "POST" autocomplete = "off" enctype="multipart/form-data">
                    {% csrf_token %}
                  <button type="submit" class="btn btn-default" name="btnLogout">Logout </button>
                  </form>

                </li>

        </ul>

      </li>
      </ul>
  </nav>

    <div class="main-menu" style="border-right:2px #800000 solid;">

        <ul>
            <section class="home">
                <li class="menu-item"><i class="fa fa-bookmark"></i>All References</li>
                <li class="menu-item"><i class="fa fa-history"></i>Recently Added</li>
                <li class="menu-item"><i class="fa fa-bookmark"></i>Recently Read</li>
                <li class="menu-item"><i class="fa fa-star"></i>Favorites</li>
                <li class="menu-item" onclick="showTrash()"><i class="fa fa-trash" ></i>Trash</li>
                <li class="menu-item"><i class="fa fa-chevron-circle-down"></i><b>My Collections </b>
                                 <i class="fa fa-plus" style="font-size:10px;" name="addfolder" onclick="document.getElementById('id01').style.display='block'"></i></li>
                                
                <li class="menu-item"><i class="fa fa-chevron-circle-down"></i><b>Private Groups</b>
                                 <i class="fa fa-plus" style="font-size: 10px;"></i></li>

               </section>             
        </ul>
    </div>

        <div class="wrapper"> <!-- style="border: dashed red" -->
     <div class="main_content" >
      
        <div class="header" style="left: 180px; width: 20px; ">

          <div class="info" >
           
              <!-- {{ row.title }} {{ row.siteName }} {{ row.dateAdded }} -->
  
              
 <table id="itemTable" cellspacing="0" cellpadding="0" border-collapse="collapse" style="font-size: 15px">
    <thead padding="0">
      <tr>
        <td onclick="sort('site')">Site</td>
        <td onclick="sort('type')"style="width: 500%">Type</td>
        <td onclick="sort('title')"style="width: 500%">Title</td>
        <td onclick="sort('date added')">Date Added</td>
        <td onclick="sort('site')">Date Accessed</td>
      
      </tr>

    </thead>
    <tbody id="itemArea" ></tbody>
  </table>

             
             
              
                <!-- <i class="fa fa-trash"> -->
         
          </div>

        </div>  
      
      </div>
       <!-- The Modal -->
                  <div id="id01" class="modal">
                    
                    <form class="modal-content" id = "form1" action="" method="POST" autocomplete="off" enctype="multipart/form-data">

                      <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>
                      {% csrf_token %}
                      <div class="container">

                        <p style="font-size: 25px; color: #800000">Create a New Collection</p>
                        <p style="font-size: 15px">Please provide a name for your collection.</p>
                        <hr>
                        <label for="foldername"><b>Collection Name</b></label>
                        <input type="text" placeholder="Enter Collection Name" name="foldername" required>

                        <div class="clearfix">
                          <button type="button" onclick="document.getElementById('id01').style.display='none'" class="cancelbtn">Cancel</button>
                          <button type="submit" class="signupbtn">Save</button>
                        </div>
                      </div>
                    </form>
                  </div>
    </div>
     <div class="right-side-bar" style="border-left:2px #800000 solid;">
      <h3 class="w3-bar-item">Details</h3>
      <ul >
      

<table id="detailTable" cellspacing="0" cellpadding="0" border-collapse="collapse" style="font-size: 15px;">
    <thead padding="0">
      <tr>
        <td padding="0"></td>
        <td padding="0"></td>
      
      </tr>

    </thead>
    <tbody id="detailArea" ></tbody>
  </table>







      
      </ul>
    </div>
   
   
    
    
</body>


<script type="text/javascript">
  var markers = {{ bookmark_list|safe }}

$(document).ready(function() {

  showRows()
    
        });


function delete_item(clicked_id){
  
   $.ajax({
                      type:"POST",
                      url:"",

                      data:{
                        
                        deleteID: clicked_id,
                        csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                      }
        }); 
   for(i=0; i< markers.length;i++){
      if(markers[i]['pk'] == clicked_id){
        markers[i]['fields']['isRemoved'] = 1;
        break;
      }
   }
   clearRow("itemTable")
   showRows()
  
    
}

function showTrash(){
  clearRow("itemTable")
  for(i=0; i< markers.length;i++){

        if(markers[i]['fields']['websiteTitle'] == "Springeropen.com" & markers[i]['fields']['isRemoved'] == 1){
         dateAdded = new Date(markers[i]['fields']['dateAdded'])
        dateAccessed = new Date(markers[i]['fields']['dateAccessed'])
           $('#itemArea').append(
            "<tr>"+
            "<td> <img class='logo-style' src='{% static 'images/springerLogo.PNG' %}''  style='height: 15px;'></td>" +
            "<td>"+ markers[i]['fields']['itemType'] +  "</td>"+
            "<td>"+ markers[i]['fields']['title'] +  "</td>"+
            "<td>" + dateAdded.toUTCString().slice(4, 22) + "</td>" +
            "<td>" + dateAccessed.toUTCString().slice(4, 22) +"</td>" + 
            "<td><i id="+ markers[i]['pk']+" class='fas fa-info-circle fa-lg' style='cursor: pointer' onclick='get_detail(this.id)'></i></td>" +
            "<td><i id="+ markers[i]['pk']+" class='fas fa-trash-alt' style='cursor: pointer' onclick='delete_item(this.id)'></i></td>" +
            "<td><i id="+ markers[i]['pk']+" class='fas fa-star' style='cursor: pointer' onclick='delete_item(this.id)'></i></td>" +
    



           "</tr>"

            );  
        }
     
      }
}
function showRows(){

// document.getElementById("itemTable").style.display = "none"; 
for(i=0; i< markers.length;i++){

        if(markers[i]['fields']['websiteTitle'] == "Springeropen.com" & markers[i]['fields']['isRemoved'] == 0){
         dateAdded = new Date(markers[i]['fields']['dateAdded'])
        dateAccessed = new Date(markers[i]['fields']['dateAccessed'])
           $('#itemArea').append(
            "<tr>"+
            "<td> <img class='logo-style' src='{% static 'images/springerLogo.PNG' %}''  style='height: 15px;'></td>" +
            "<td>"+ markers[i]['fields']['itemType'] +  "</td>"+
            "<td>"+ markers[i]['fields']['title'] +  "</td>"+
            "<td>" + dateAdded.toUTCString().slice(4, 22) + "</td>" +
            "<td>" + dateAccessed.toUTCString().slice(4, 22) +"</td>" + 
            "<td><i id="+ markers[i]['pk']+" class='fas fa-info-circle fa-lg' style='cursor: pointer' onclick='get_detail(this.id)'></i></td>" +
            "<td><i id="+ markers[i]['pk']+" class='fas fa-trash-alt' style='cursor: pointer' onclick='delete_item(this.id)'></i></td>" +
            "<td><i id="+ markers[i]['pk']+" class='fas fa-star' style='cursor: pointer' onclick='delete_item(this.id)'></i></td>" +
    



           "</tr>"

            );  
        }
     
      }




}

function clearRow(tableName){
  var table = document.getElementById(tableName);
    //or use :  var table = document.all.tableid;

    for(var i = table.rows.length - 1; i > 0; i--)
    {
        table.deleteRow(i);
    }
}
function get_detail(clicked_id){
    var id = parseInt(clicked_id);
  
    clearRow("detailTable")
     
   
    

   for(i=0; i< markers.length;i++){
      if(markers[i]['pk'] == id){
          var dt = new Date( markers[i]['fields']['dateAdded']);
          var access = new Date( markers[i]['fields']['dateAccessed']);
           added =  (("0"+dt.getDate()).slice(-2)) +"/"+ (("0"+(dt.getMonth()+1)).slice(-2)) +"/"+ (dt.getFullYear()) +" "+ (("0"+dt.getHours()).slice(-2)) +":"+ (("0"+dt.getMinutes()).slice(-2));

            accessed =  (("0"+access.getDate()).slice(-2)) +"/"+ (("0"+(access.getMonth()+1)).slice(-2)) +"/"+ (access.getFullYear()) +" "+ (("0"+access.getHours()).slice(-2)) +":"+ (("0"+access.getMinutes()).slice(-2));
           
       $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Website: </td>"+ "<td>"+ markers[i]['fields']['title'] +  "</td></tr>" );  
       $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Item type: </td>"+ "<td>"+ markers[i]['fields']['itemType'] +  "</td></tr>" );  
       $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> URL: </td>"+ "<td>"+ markers[i]['fields']['url'] +  "</td></tr>" );  
       $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Title: </td>"+ "<td>"+ markers[i]['fields']['title'] +  "</td></tr>" );  
       $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Author: </td>"+ "<td>"+ markers[i]['fields']['author'] +  "</td></tr>" );  
       $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Description: </td>"+ "<td>"+ markers[i]['fields']['description'] +  "</td></tr>" );  
       $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Collection: </td>"+ "<td>"+ markers[i]['fields']['journalItBelongs'] +  "</td></tr>" );  
       $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Publication Year: </td>"+ "<td>"+ markers[i]['fields']['publicationYear'] +  "</td></tr>" );  
       $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Date added: </td>"+ "<td>"+ added +  "</td></tr>" );  
       $('#detailArea').append("<tr><td style='text-align: right; vertical-align:top'> Date Accessed: </td>"+ "<td>"+ accessed +  "</td></tr>" );  

       break;
      }
  }
  
  
}


function sort(sortType){
 
  var table, rows, switching, i, x, y, shouldSwitch;
  table = document.getElementById("myTable");
  switching = true;
  /*Make a loop that will continue until
  no switching has been done:*/
  while (switching) {

    //start by saying: no switching is done:
    switching = false;
    rows = table.rows;
    /*Loop through all table rows (except the
    first, which contains table headers):*/
    for (i = 1; i < (rows.length - 1); i++) {
      //start by saying there should be no switching:
      shouldSwitch = false;
      /*Get the two elements you want to compare,
      one from current row and one from the next:*/
      if(sortType == 'title'){
      x = rows[i].getElementsByTagName("TD")[1];
      y = rows[i + 1].getElementsByTagName("TD")[1];
        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
          //if so, mark as a switch and break the loop:
          rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
          switching = true;
          shouldSwitch = true;
          break;
        }
      } else if(sortType == 'date added'){
          x = rows[i].getElementsByTagName("TD")[2];
          y = rows[i + 1].getElementsByTagName("TD")[2];
          if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
        //if so, mark as a switch and break the loop:
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
        shouldSwitch = true;
        break;
      }
      }
      //check if the two rows should switch place:
      
    }
    if (shouldSwitch) {
      /*If a switch has been marked, make the switch
      and mark that a switch has been done:*/
      
    }
  }
}    

</script> 


</html>